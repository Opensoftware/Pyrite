<%= stylesheet_link_tag 'main' %>
<%= stylesheet_link_tag 'plany' %>

<h2> Rezerwacje sal </h2>

<% @room.numer = params[:room][:sala] %>
	<% form_tag '',{ :id => "edycjaplanow"}  do %>
Sala:  <%= collection_select(:room,:numer, Room.find(:all).sort {|x,y| x.numer.to_i <=> y.numer.to_i}, :numer, :numer, {:prompt => "Wybierz sale"}) %>
	<%= hidden_field(:plan,:wazneod, :value => @date) %>
<% end %>

<div id="Eplany">
<table align="center" class="navigate">
<tr>
<td>
  <%= link_to("<< poprzedni tydzień", {:controller => 'main', :action => 'rezerwacje', :params => { :data => Date.parse("#{@date - 7.days}"), :room => {:sala => @sala}}  } ) %>
	<br /><span style="font-size:small"><%= @date - 7.days %></span>
</td>
<td>
</td>
<td>
  <%= link_to("następny tydzień >>", {:controller => 'main', :action => 'rezerwacje', :params => { :data => Date.parse("#{@date.next_week}"), :room => {:sala => @sala} }}) %>
	<br /><span style="font-size:small"><%= @date.next_week %></span>
</td>
</tr>
</table>
<br />
    <table class="plan" align="center">
	<tr style="font-size:small">
	    <td id="tableHeader">  </td>
            <td><%= @date %> </td>
            <td><%= @date + 1.days %></td>
            <td><%= @date + 2.days %></td>
            <td><%= @date + 3.days %></td>
            <td><%= @date + 4.days %></td>
            <td><%= @date + 5.days %></td>
            <td><%= @date + 6.days %></td>
	</tr>
	<tr style="font-size:small">
	    <th id="tableHeader"> Godz </th>
            <th>Pon</th>
            <th>Wtorek</th>
            <th>Środa</th>
            <th>Czwartek</th>
            <th>Piątek</th>
            <th>Sobota</th>
            <th>Niedziela</th>
	</tr>
	<% for go in @godz1 %>
	  <% @i += 1 %>
	  <% @j += 1 %>
		<% @line +=1 %>
	  <tr <%= @line > 4  ? "class='lightline'" : "" %> >
			<% @line > 7 ? @line = 0 : "" %>
	   <% @j == 4 ? @j=0 : "" %>
           <% if @j == 1 %>
	    <td class="hour" rowspan="4"><%= go + "-#{@godz[@i]}" %>
	    </td>
	   <% end %>
	   <% for dn in @dni1 %>
             <% @dl = @qwe[go][dn].to_s.split("::") %>
	     <% if @dl[2].to_i != 0 %>
		<% @blok += 1 %>
		<% @blok_ln[dn] = @dl[2].to_i * 3 %>
		<% @blok_ln[dn] -= 1 %>
	       <td <%= @dl[4] == "W" ? "class='blok-w'" : "class='blok-cw'" %> rowspan="<%= @dl[2].to_i * 3 %>" >
			<table class="blokinfo" >
				<tr height=15px><td class="head_info"><%= @dl[4] %> </td></tr>
				<tr height=25%><td class="middle_info"><b><%= @dl[3] %></b><br/><small><%= @dl[0] %></small></b></td></tr>
				<tr height=15px><td class="bottom_info">
			<span class="left">
 			</span>
			<span class="right"><% @dl[6] == "A0" ? @b="#{@dl[5]}" : @b="#{@dl[6]}, #{@dl[5]}" %></span><br/>
				<% if session[:uid].nil? %>
				<% else %>
				<% if current_user.has_role? 'moderator' %>
				<%= link_to("Edytuj", {:controller => 'siatka', :action => 'edit', :params => { :id => @dl[5] }}) %>
				<%else %>
			  	<% end %>
				<%end%>
		                  </td>
 				</tr>
			</table>

	       </td>
	     <% else %>
		<% if @blok_ln[dn] != 0  %>
			<% @blok_ln[dn] -= 1 %>
			<!--<td>#<%= @blok %> <%= @blok_ln %></td>-->
		<% else %>
			<td class="blokpusty"></td>
		<%end%>
	     <% end %>

        <% end %>


	<% end %>
	</tr>
      </table>



</div>
<%= observe_form :edycjaplanow,
		:frequency => 1,
		:update => "Eplany",
		:complete => "Element.show('Eplany')",
		:url => { :action => "rezer" }
%>
